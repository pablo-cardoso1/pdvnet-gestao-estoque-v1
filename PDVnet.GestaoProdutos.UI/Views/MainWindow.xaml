<Window x:Class="PDVnet.GestaoProdutos.UI.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:PDVnet.GestaoProdutos.UI.ViewModels"
        xmlns:converters="clr-namespace:PDVnet.GestaoProdutos.UI.Converters"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Sistema de Gestão de Estoque - PDVNet" 
        Height="600" 
        Width="1000"
        WindowStartupLocation="CenterScreen"
        d:DataContext="{d:DesignInstance Type=local:MainViewModel, IsDesignTimeCreatable=True}">

    <Window.Resources>
        <converters:EstoqueBaixoColorConverter x:Key="EstoqueBaixoColorConverter"/>
        <converters:ZeroToVisibilityConverter x:Key="ZeroToVisibilityConverter"/>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Cabeçalho -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal">
                <Button Content="➕ Novo" 
                        Command="{Binding NovoCommand}"
                        FontSize="12"
                        Padding="10,5"
                        Margin="0,0,5,0"
                        Background="Green"
                        Foreground="White"/>

                <Button Content="✏️ Editar" 
                        Command="{Binding EditarCommand}"
                        FontSize="12"
                        Padding="10,5"
                        Margin="5,0,5,0"
                        Background="Orange"
                        Foreground="White"/>

                <Button Content="🗑️ Excluir" 
                        Command="{Binding ExcluirCommand}"
                        FontSize="12"
                        Padding="10,5"
                        Margin="5,0,5,0"
                        Background="Red"
                        Foreground="White"/>

                <Button Content="🔄 Atualizar" 
                        Command="{Binding CarregarProdutosCommand}"
                        FontSize="12"
                        Padding="10,5"
                        Margin="5,0,10,0"/>
            </StackPanel>

            <TextBlock Text="Sistema de Gestão de Estoque" 
                       FontSize="16" 
                       FontWeight="Bold"
                       VerticalAlignment="Center"
                       Margin="20,0,0,0"/>
        </StackPanel>

        <!-- Lista de Produtos -->
        <DataGrid Grid.Row="1" 
                  ItemsSource="{Binding Produtos}"
                  SelectedItem="{Binding ProdutoSelecionado, Mode=TwoWay}"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  EnableRowVirtualization="True"
                  EnableColumnVirtualization="True"
                  VirtualizingStackPanel.IsVirtualizing="True"
                  VirtualizingStackPanel.VirtualizationMode="Recycling"
                  Margin="0,0,0,10">
            <DataGrid.Columns>
                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="50"/>
                <DataGridTextColumn Header="Nome" Binding="{Binding Nome}" Width="200"/>
                <DataGridTextColumn Header="Descrição" Binding="{Binding Descricao}" Width="250"/>
                <DataGridTextColumn Header="Preço" Binding="{Binding Preco, StringFormat='{}{0:C}'}" Width="100"/>
                <DataGridTextColumn Header="Estoque" Binding="{Binding Quantidade}" Width="80"/>
                <DataGridTextColumn Header="Data Cadastro" Binding="{Binding DataCadastro, StringFormat='{}{0:dd/MM/yyyy}'}" Width="120"/>
                <DataGridTextColumn Header="Última Atualização" Binding="{Binding DataAtualizacao, StringFormat='{}{0:dd/MM/yyyy HH:mm}'}" Width="160"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Rodapé com Dashboard -->
        <Border Grid.Row="2" Background="#FFF0F0F0" Padding="15" BorderThickness="1" BorderBrush="#FFCCCCCC">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Estatísticas Gerais -->
                <StackPanel Grid.Column="0" Orientation="Vertical">
                    <TextBlock Text="📊 DASHBOARD" FontWeight="Bold" FontSize="12" Margin="0,0,0,5"/>

                    <StackPanel Orientation="Horizontal" Margin="0,2">
                        <TextBlock Text="Total de Produtos:" FontWeight="SemiBold" Width="140"/>
                        <TextBlock Text="{Binding TotalProdutos}" FontWeight="Bold"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,2">
                        <TextBlock Text="Valor Total Estoque:" FontWeight="SemiBold" Width="140"/>
                        <TextBlock Text="{Binding ValorTotalEstoque, StringFormat='{}{0:C}'}" FontWeight="Bold" Foreground="Green"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,2">
                        <TextBlock Text="Produtos com Estoque Baixo:" FontWeight="SemiBold" Width="170"/>
                        <TextBlock Text="{Binding ProdutosEstoqueBaixo}" FontWeight="Bold" 
                           Foreground="{Binding ProdutosEstoqueBaixo, Converter={StaticResource EstoqueBaixoColorConverter}}"
                           Margin="5,0,0,0"/>
                    </StackPanel>
                </StackPanel>

                <!-- Separador -->
                <Rectangle Grid.Column="1" Width="1" Fill="#FFCCCCCC" Margin="10,0"/>

                <!-- Alerta Estoque Baixo -->
                <StackPanel Grid.Column="2" Orientation="Vertical">
                    <TextBlock Text="⚠️ ALERTA - ESTOQUE BAIXO" FontWeight="Bold" FontSize="12" 
                       Foreground="Red" Margin="0,0,0,5"/>

                    <ItemsControl ItemsSource="{Binding ProdutosEstoqueBaixoLista}" MaxHeight="60" 
                         ScrollViewer.VerticalScrollBarVisibility="Auto">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="0,1">
                                    <TextBlock Text="{Binding Nome}" FontWeight="SemiBold" Width="150"/>
                                    <TextBlock Text=" - Estoque: " />
                                    <TextBlock Text="{Binding Quantidade}" Foreground="Red" FontWeight="Bold"/>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <TextBlock Text="Nenhum produto com estoque baixo" 
                       Visibility="{Binding ProdutosEstoqueBaixo, Converter={StaticResource ZeroToVisibilityConverter}}"
                       FontStyle="Italic" Foreground="Gray" Margin="0,5"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>